<!DOCTYPE html>
<html>
  <head>
    <title>Parent</title>
  </head>
  <style>
    div {
      background-color: red;
    }
  </style>

  <body>
    <script>
      var iframe = document.createElement("iframe");
      // iframe.hidden = true;
      iframe.src = "about:blank";
      document.body.appendChild(iframe);

      function inject(code, frame, ismodule) {
        const script = frame.contentWindow.document.createElement("script");
        if (ismodule) {
          script.type = "module";
        }
        script.textContent = code;
        frame.contentWindow.document.body.appendChild(script);
      }

      iframe.onload = function () {
        const injectedCode = `Object.defineProperty(window.document, 'getElementById', {
				set: function(args) {
					return window.parent.document.getElementById(args);
				}
			});`;

        const createDiv = `
					const appDiv = window.parent.document.createElement('div');
					window.parent.document.body.appendChild(appDiv);
				`;

        const userCode = `
					import Vue from "./vue.esm.browser.js";
					new Vue({
						data: {
							message: "Hello Vue!",
						},
						render: function (createElement) {
							return createElement("div", this.message);
						},
					}).$mount(appDiv);

				`;

        inject(injectedCode, iframe);
        inject(createDiv, iframe);
        inject(userCode, iframe, true);

        console.log(window.__ZK_PARENT);
      };
    </script>
  </body>
</html>
